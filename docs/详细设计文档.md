#### 4.1.x activitybl模块

(1) 模块概述

activitybl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

activitybl模块的职责及接口参见软件体系结构文档表x。

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、控制层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如业务逻辑层和数据层之间，我们添加activitydataservice.ActivityDataService接口。为了隔离业务逻辑职责和逻辑控制职责，我们增加了控制层的ActivityController，这样ActivityController会将操作优惠活动相关的逻辑处理委托给ActivityBL。

activitybl模块的设计如图x所示。

![]()

<div style="text-align: center">图x activitybl模块各个类的设计</div>

activitybl模块各个类的职责如表x所示。

<div style="text-align: center">表x activitybl模块各个类的职责</div>

|    模块    |            职责            |
| :--------: | :------------------------: |
| ActivityBL | 负责实现操作优惠活动的服务 |

(3) 模块内部类的接口规范

ActivityBL的接口规范如表x所示。

<div>
    <table>
        <caption><strong>表x ActivityBL的接口规范</strong><caption>
        <hr/>
        <caption><strong>提供的服务（供接口）</strong></caption>
        <tr>
            <td rowspan="4">ActivityBL.publishActivity</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO publishActivity(ActivityForm activityForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>activityForm格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>发布一个优惠活动</td>
        </tr>
        <tr>
            <td rowspan="4">ActivityBL.getActivities</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getActivities()</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>无</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取所有优惠活动信息</td>
        </tr>
            <td rowspan="4">ActivityBL.deleteActivity</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO deleteActivity(int activityId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>activityId格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>删除优惠活动</td>
        </tr>
        <tr>
            <td rowspan="4">ActivityBL.getActivityById</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getActivityById(int activityId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>activityId格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取指定id的优惠活动</td>
        </tr>
    </table>
<div>
<div>
    <table>
        <caption><strong>需要的服务（需接口）</strong><caption>
        <tr>
            <td style="font-weight:bold">服务名</td>
            <td style="font-weight:bold">服务</td>
        </tr>
        <tr>
            <td>ActivityDataService.insertActivity(Activity activity)</td>
            <td>在数据库中插入一个优惠活动</td>
        </tr>
        <tr>
            <td>
                ActivityDataService.insertActivityAndMovie(int activityId,List&lt;Integer&gt; movieId)
            </td>
            <td>在数据库中插入一条活动和电影的关系</td>
        </tr>
        <tr>
            <td>ActivityDataService.selectActivities()</td>
            <td>返回所有优惠活动信息</td>
        </tr>
        <tr>
            <td>ActivityDataService.selectActivitiesByMovie(int movieId)</td>
            <td>返回特定电影的优惠活动信息</td>
        </tr>
        <tr>
            <td>ActivityDataService.selectById(int id)</td>
            <td>获取指定id的优惠活动</td>
        </tr>
        <tr>
            <td>ActivityDataService.deleteActivityById(int id)</td>
            <td>删除指定的优惠活动</td>
        </tr>
        <tr>
            <td>ActivityDataService.deleteActivityAndMovie(int id)</td>
            <td>根据活动id删除活动和电影关系</td>
        </tr>
    </table>
</div>
(4) 业务逻辑层的动态模型

图x~x是影院管理系统中ActivityBL进行业务逻辑处理时的顺序图。

![]()

<div style="text-align: center">图x 发布优惠活动的顺序图</div>

![]()

<div style="text-align: center">图x 获取所有优惠活动的顺序图</div>

![]()

<div style="text-align: center">图x 修改优惠活动的顺序图</div>

![]()

<div style="text-align: center">图x 删除优惠活动的顺序图</div>

![]()

<div style="text-align: center">图x 获取优惠活动的顺序图</div>

由于ActivityBL只作为工具进行业务逻辑处理，不持有成员变量，因而在处理过程中是无状态的。

(5) 业务逻辑层的设计原理

利用SpringBoot的依赖注入，通过数据层接口获得po后，进行业务逻辑处理，将需要在页面上显示的信息封装成vo，最后封装成ResponseVO返回给上层。

#### 4.1.x cardbl模块

(1) 模块概述

cardbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

cardbl模块的职责及接口参见软件体系结构文档表x。

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、控制层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如业务逻辑层和数据层之间，我们添加carddataservice.CardDataService接口。为了隔离业务逻辑职责和逻辑控制职责，我们增加了控制层的CardController，这样CardController会将操作优惠活动相关的逻辑处理委托给ActivityBL。

cardbl模块的设计如图x所示。

![]()

<div style="text-align: center">图x cardbl模块各个类的设计</div>

cardbl模块各个类的职责如表x所示。

<div style="text-align: center">表x cardbl模块各个类的职责</div>

|    模块    |             职责             |
| :--------: | :--------------------------: |
| CardTypeBL | 负责实现操作会员卡类型的服务 |
| VIPCardBL  | 负责实现操作用户会员卡的服务 |

(3) 模块内部类的接口规范

CardTypeBL和VIPCardBL的接口规范如表x~x所示。

<div>
    <table>
        <caption><strong>表x CardTypeBL的接口规范</strong><caption>
        <hr/>
        <caption><strong>提供的服务（供接口）</strong></caption>
        <tr>
            <td rowspan="4">CardTypeBL.getCards</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getCards()</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>无</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取所有会员卡类型</td>
        </tr>
        <tr>
            <td rowspan="4">CardTypeBL.publishCard</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO publishCard(CardTypeForm cardTypeForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>cardTypeForm信息格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>发布会员卡类型</td>
        </tr>
        <tr>
            <td rowspan="4">CardTypeBL.deleteCard</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO deleteCard(int cardId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>cardId格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>删除会员卡类型</td>
        </tr>
        <tr>
            <td rowspan="4">CardTypeBL.updateCard</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO updateCard(int cardId, CardTypeForm cardTypeForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>cardId和cardTypeForm格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>更新会员卡类型信息</td>
        </tr>
    </table>
<div>
<div>
    <table>
        <caption><strong>需要的服务（需接口）</strong><caption>
        <tr>
            <td style="font-weight:bold">服务名</td>
            <td style="font-weight:bold">服务</td>
        </tr>
        <tr>
            <td>CardTypeDataService.selectAllCards()</td>
            <td>获取所有会员卡类型</td>
        </tr>
        <tr>
            <td>CardTypeDataService.insertOneCard(CardType cardType)</td>
            <td>在数据库中插入会员卡类型</td>
        </tr>
        <tr>
            <td>CardTypeDataService.deleteCardById(int cardId)</td>
            <td>在数据库中删除会员卡类型，将会员卡类型状态设为0</td>
        </tr>
        <tr>
            <td>CardTypeDataService.updateCardById(int cardId, CardType cardType)</td>
            <td>更新会员卡类型信息</td>
        </tr>
    </table>
</div>

<div>
    <table>
        <caption><strong>表x VIPCardBL的接口规范</strong><caption>
        <hr/>
        <caption><strong>提供的服务（供接口）</strong></caption>
        <tr>
            <td rowspan="4">VIPCardBL.addVIPCard</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO addVIPCard(int userId, int cardTypeId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>userId和cardTypeId格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>为指定用户增加会员卡</td>
        </tr>
        <tr>
            <td rowspan="4">VIPCardBL.getCardByUserId</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getCardByUserId(int userId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>userId格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取某用户的有效会员卡</td>
        </tr>
        <tr>
            <td rowspan="4">VIPCardBL.charge</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO charge(VIPCardForm vipCardForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>vipCardForm格式正确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>为指定会员卡充值制定金额</td>
        </tr>
        <tr>
            <td rowspan="4">VIPCardBL.changeVIPCard</td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO changeVIPCard(int cardId, int cardTypeId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>cardId和carTypeId格式真确</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>更换指定用户的会员卡类型</td>
        </tr>
    </table>
<div>
<div>
    <table>
        <caption><strong>需要的服务（需接口）</strong><caption>
        <tr>
            <td style="font-weight:bold">服务名</td>
            <td style="font-weight:bold">服务</td>
        </tr>
        <tr>
            <td>VIPCardDataService.insertOneCard(VIPCard vipCard)</td>
            <td>为指定用户增加会员卡</td>
        </tr>
        <tr>
            <td>VIPCardDataService.selectCardByUserId(int userId)</td>
            <td>获取某用户的有效会员卡</td>
        </tr>
        <tr>
            <td>VIPCardDataService.updateCardBalance(int id, double balance)</td>
            <td>为指定会员卡更新余额</td>
        </tr>
        <tr>
            <td>VIPCardDataService.selectCardById(int id)</td>
            <td>获取指定id的会员卡</td>
        </tr>
        <tr>
            <td>VIPCardDataService.deleteCardById(int cardId)</td>
            <td>从数据库中删除指定id的会员卡，将状态设置为0</td>
        </tr>
    </table>
</div>



(4) 业务逻辑层的动态模型

图x~x是影院管理系统中CardTypeBL进行业务逻辑处理时的顺序图。

![]()

<div style="text-align: center">图x 获取所有会员卡类型的顺序图</div>

![]()

<div style="text-align: center">图x 发布会员卡类型的顺序图</div>

![]()

<div style="text-align: center">图x 删除会员卡类型的顺序图</div>

![]()

<div style="text-align: center">图x 更新会员卡类型的顺序图</div>

由于CardTypeBL只作为工具进行业务逻辑处理，不持有成员变量，因而在处理过程中是无状态的。



图x~x是影院管理系统中VIPCardBL进行业务逻辑处理时的顺序图。

![]()

<div style="text-align: center">图x 为用户增加会员卡的顺序图</div>

![]()

<div style="text-align: center">图x 获取用户会员卡的顺序图</div>

![]()

<div style="text-align: center">图x 充值会员卡的顺序图</div>

![]()

<div style="text-align: center">图x 更换会员卡的顺序图</div>

由于VIPCardBL只作为工具进行业务逻辑处理，不持有成员变量，因而在处理过程中是无状态的。

(5) 业务逻辑层的设计原理

利用SpringBoot的依赖注入，通过数据层接口获得po后，进行业务逻辑处理，将需要在页面上显示的信息封装成vo，最后封装成ResponseVO返回给上层。

#### 4.1.x couponbl模块

(1) 模块概述

couponbl模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

couponbl模块的职责及接口参见软件体系结构文档表x。

(2) 整体结构

根据体系结构的设计，我们将系统分为展示层、控制层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们会添加接口。比如业务逻辑层和数据层之间，我们添加coupondataservice.CouponDataService接口。为了隔离业务逻辑职责和逻辑控制职责，我们增加了控制层的CouponController，这样CouponController会将操作优惠活动相关的逻辑处理委托给CouponBL。

couponbl模块的设计如图x所示。

![]()

<div style="text-align: center">图x couponbl模块各个类的设计</div>

couponbl模块各个类的职责如表x所示。

<div style="text-align: center">表x couponbl模块各个类的职责</div>

|   模块   |           职责           |
| :------: | :----------------------: |
| CouponBL | 负责实现操作优惠券的服务 |

(3) 模块内部类的接口规范

CouponBL的接口规范如表x所示。

<div>
    <table>
        <caption><strong>表x CouponBL的接口规范</strong><caption>
        <hr/>
        <caption><strong>提供的服务（供接口）</strong></caption>
        <tr>
            <td rowspan="4"> CouponBL.getAllCoupons </td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getAllCoupons()</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>管理员准备赠送优惠券</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取所有优惠券</td>
        </tr>
        <tr>
            <td rowspan="4"> CouponBL.getUsersByConsume </td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getUsersByConsume(double totalConsume)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>totalConsume符合输入规范</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>获取满足一定消费总额的用户</td>
        </tr>
        <tr>
            <td rowspan="4"> CouponBL.presentCoupon2User </td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO presentCoupon2User(PresentForm presentForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>presentForm符合输入规范</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>批量赠送优惠券</td>
        </tr>
        <tr>
            <td rowspan="4"> CouponBL.getCouponsByUser </td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO getCouponsByUser(int userId)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>userId存在</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>返回用户拥有的有效优惠券</td>
        </tr>
        <tr>
            <td rowspan="4"> CouponBL.addCoupon </td>
        </tr>
        <tr>
            <td><strong>语法</strong></td>
            <td>public ResponseVO addCoupon(CouponForm couponForm)</td>
        </tr>
        <tr>
            <td><strong>前置条件</strong></td>
            <td>couponForm符合输入规范</td>
        </tr>
        <tr>
            <td><strong>后置条件</strong></td>
            <td>发布新优惠券</td>
        </tr>
    </table>
<div>
<div>
    <table>
        <caption><strong>需要的服务（需接口）</strong><caption>
        <tr>
            <td style="font-weight:bold">服务名</td>
            <td style="font-weight:bold">服务</td>
        </tr>
        <tr>
            <td>ConsumeBL.getConsumeQualifiedUsers(double totalConsume)</td>
            <td>获取满足一定消费总额的用户</td>
        </tr>
        <tr>
            <td>CouponDataService.selectAllCoupons()</td>
            <td>获取所有有效优惠券</td>
        </tr>
        <tr>
            <td>CouponDataService.insertCouponUser(int couponId,int userId)</td>
            <td>赠送某种优惠券给某个用户</td>
        </tr>
        <tr>
            <td>CouponDataService.insertCoupon(Coupon coupon)</td>
            <td>在数据库中插入优惠券</td>
        </tr>
        <tr>
            <td>CouponDataService.selectCouponByUser(int userId)</td>
            <td>获取用户拥有的所有有效优惠券</td>
        </tr>
    </table>
</div>


(4) 业务逻辑层的动态模型

图x~x是影院管理系统中CouponBL进行业务逻辑处理时的顺序图。

![]()

<div style="text-align: center">图x 获取所有优惠券的顺序图</div>

![]()

<div style="text-align: center">图x 获取消费满一定金额的用户的顺序图</div>

![]()

<div style="text-align: center">图x 赠送优惠券给用户的顺序图</div>

![]()

<div style="text-align: center">图x 获取用户优惠券的顺序图</div>

![]()

<div style="text-align: center">图x 添加优惠券的顺序图</div>

由于CouponBL只作为工具进行业务逻辑处理，不持有成员变量，因而在处理过程中是无状态的。

(5) 业务逻辑层的设计原理

利用SpringBoot的依赖注入，通过数据层接口获得po后，进行业务逻辑处理，将需要在页面上显示的信息封装成vo，最后封装成ResponseVO返回给上层。

